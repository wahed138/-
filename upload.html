<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª + Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Cairo', Arial, sans-serif;
      background-color: #121212;
      color: white;
      padding: 20px;
    }
    h2 {
      margin-top: 20px;
    }
    input, select, button {
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 6px;
      font-size: 16px;
    }
    input, select {
      width: 100%;
      background-color: #1e1e1e;
      color: white;
    }
    button {
      background-color: #6200ee;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }
    button:hover {
      background-color: #3700b3;
    }
    .toast {
      margin-top: 10px;
      padding: 12px;
      border-radius: 8px;
      font-size: 16px;
      display: none;
      text-align: center;
    }
    .toast.success { background-color: #2e7d32; color: #fff; }
    .toast.error { background-color: #c62828; color: #fff; }
    canvas {
      background: #1e1e1e;
      border-radius: 8px;
      padding: 10px;
      margin-top: 20px;
    }
    #adminPanel {
      display: none; 
      max-width: 500px;
      margin: auto;
    }
    #imagePreview {
      display: none;
      margin: 10px auto;
      max-width: 100%;
      border-radius: 10px;
      border: 2px solid #444;
    }
  </style>
</head>
<body>

  <h2>ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"><br>
  <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>
  <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

  <div id="toast" class="toast"></div>

  <!-- Ù„ÙˆØ­Ø© Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª -->
  <div id="adminPanel">
    <h2>ğŸ“¤ Ù†Ø´Ø± ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
    <input type="text" id="titleInput" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ"><br>
    <input type="text" id="urlInput" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨ØµÙŠØºØ© embed"><br>
    <input type="text" id="imageInput" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (thumbnail)" oninput="previewImage()"><br>
    <img id="imagePreview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©">

    <select id="subjectInput" onchange="updateTeachers()">
      <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
      <option value="Ø¹Ø±Ø¨ÙŠ">Ø¹Ø±Ø¨ÙŠ</option>
      <option value="Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ">Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</option>
      <option value="Ø¬ØºØ±Ø§ÙÙŠØ§">Ø¬ØºØ±Ø§ÙÙŠØ§</option>
      <option value="ØªØ§Ø±ÙŠØ®">ØªØ§Ø±ÙŠØ®</option>
      <option value="ÙÙŠØ²ÙŠØ§Ø¡">ÙÙŠØ²ÙŠØ§Ø¡</option>
      <option value="ÙƒÙŠÙ…ÙŠØ§Ø¡">ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
      <option value="Ø£Ø­ÙŠØ§Ø¡">Ø£Ø­ÙŠØ§Ø¡</option>
      <option value="Ø§Ø¯Ø¨ÙŠ">Ø§Ø¯Ø¨ÙŠ</option>
      <option value="Ø±ÙŠØ§Ø¶Ù‡">Ø±ÙŠØ§Ø¶Ù‡</option>
    </select><br>

    <select id="teacherInput" disabled>
      <option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³</option>
    </select><br>

    <select id="chapterInput">
      <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) --</option>
      <option value="Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø£ÙˆÙ„">Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø£ÙˆÙ„</option>
      <option value="Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ">Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
      <option value="Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø«Ø§Ù„Ø«">Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø«Ø§Ù„Ø«</option>
      <option value="Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</option>
      <option value="Ø§Ù„Ù…Ø¹Ø³ÙƒØ±Ø§Øª">Ø§Ù„Ù…Ø¹Ø³ÙƒØ±Ø§Øª</option>
    </select><br>

    <button onclick="publishVideo()">Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>

    <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø©</h2>
    <canvas id="videosChart" width="400" height="200"></canvas>
  </div>

  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
    authDomain: "thanawy-1383.firebaseapp.com",
    databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
    projectId: "thanawy-1383",
    storageBucket: "thanawy-1383.firebasestorage.app",
    messagingSenderId: "1026664406457",
    appId: "1:1026664406457:web:87d71f7e41bef36ba0aa68",
    measurementId: "G-J5R2EFM2D0"
  };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // ğŸ” UID Ø§Ù„Ø£Ø¯Ù…Ù†
    const ADMIN_UID ="jstdqdiNVDb5erNApQuzo6d9RAe2";

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function login() {
      const email = document.getElementById("emailInput").value.trim();
      const password = document.getElementById("passwordInput").value.trim();

      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          const user = userCredential.user;
          if (user.uid === ADMIN_UID) {
            showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒØ£Ø¯Ù…Ù† âœ…");
            document.getElementById("adminPanel").style.display = "block";
          } else {
            showToast("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ÙŠØ³ Ø£Ø¯Ù…Ù†", true);
            auth.signOut();
          }
        })
        .catch(error => {
          showToast("Ø®Ø·Ø£: " + error.message, true);
        });
    }

    // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ù„ÙƒÙ„ Ù…Ø§Ø¯Ø©
    const teachersPerSubject = {
      "Ø¹Ø±Ø¨ÙŠ": ["Ù…Ø­Ù…Ø¯ ØµÙ„Ø§Ø­", "Ø±Ø¶Ø§ ÙØ§Ø±ÙˆÙ‚", "Ù…Ø¯Ø±Ø³ Ø¬"],
      "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ": ["Ù…Ø³ Ù…ÙŠ","Ø§Ù†Ø¬Ù„Ø´Ø§ÙˆÙŠ", "ÙˆØ§Ø¦Ù„ Ù…ÙŠÙ„Ø§Ø¯"],
      "Ø¬ØºØ±Ø§ÙÙŠØ§": ["Ù…Ø¯Ø±Ø³ 1", "Ù…Ø¯Ø±Ø³ 2", "Ù…Ø¯Ø±Ø³ 3"],
      "Ø±ÙŠØ§Ø¶Ù‡": ["Ø§Ø­Ù…Ø¯ Ø¹ØµØ§Ù…", "Ù…Ø¯Ø±Ø³ 2", "Ù…Ø¯Ø±Ø³ 3"],
      "ÙÙŠØ²ÙŠØ§Ø¡": ["ÙƒÙŠØ±Ù„Ø³ Ø§Ù„Ù‚Øµ", "Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø¹Ø¨ÙˆØ¯", "Ø­Ø³Ø§Ù… Ø®Ù„ÙŠÙ„", "ÙÙŠØ²ÙŠØ§Ø¦ÙŠ 3"],
      "ÙƒÙŠÙ…ÙŠØ§Ø¡": ["Ø®Ø§Ù„Ø¯ ØµÙ‚Ø±", "Ø¹Ø¨Ø¯ Ø§Ù„Ø¬ÙˆØ§Ø¯", "Ø¬ÙˆÙ† Ø¬Ù‡Ø¨Ø°"],
      "Ø£Ø­ÙŠØ§Ø¡": ["Ø§Ø­Ù…Ø¯ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ", "Ø§Ø­Ù…Ø¯ Ø§ÙŠÙ…Ù†", "Ø§Ù„Ø¬ÙŠÙˆ", "Ø§Ù…Ù†ÙŠÙ‡ Ø§Ù„Ø³ÙŠØ¯"],
      "Ø§Ø¯Ø¨ÙŠ": ["Ø§Ù„Ù…Ø¤Ø±Ø®(Øª)", "Ø§Ù„Ù‚ÙŠØµØ±(Ø¬)", "Ø¬ÙŠÙˆ Ù…Ø§Ø¬Ø¯", "Ø¬ÙˆÙ‡Ø±ÙŠ(Ø¬ÙŠÙˆ)"]
    };

    function updateTeachers() {
      const subject = document.getElementById("subjectInput").value;
      const teacherSelect = document.getElementById("teacherInput");
      teacherSelect.innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³</option>';

      if (!subject || !teachersPerSubject[subject]) {
        teacherSelect.disabled = true;
        return;
      }

      teachersPerSubject[subject].forEach(teacher => {
        const option = document.createElement("option");
        option.value = teacher;
        option.textContent = teacher;
        teacherSelect.appendChild(option);
      });
      teacherSelect.disabled = false;
    }

    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
    function previewImage() {
      const url = document.getElementById("imageInput").value.trim();
      const preview = document.getElementById("imagePreview");
      if (url) {
        preview.src = url;
        preview.style.display = "block";
      } else {
        preview.style.display = "none";
      }
    }

    // Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    function publishVideo() {
      const title = document.getElementById("titleInput").value.trim();
      const url = document.getElementById("urlInput").value.trim();
      const imageUrl = document.getElementById("imageInput").value.trim();
      const subject = document.getElementById("subjectInput").value;
      const teacher = document.getElementById("teacherInput").value;
      const chapter = document.getElementById("chapterInput").value;

      if (!title || !url || !imageUrl || !subject || !teacher) {
        showToast("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©", true);
        return;
      }

      const videoId = Date.now();
      db.ref("videos/" + videoId).set({
        title, url, imageUrl, subject, teacher, chapter: chapter || null, createdAt: new Date().toISOString()
      }, (error) => {
        if (error) {
          showToast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", true);
        } else {
          showToast("âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­");
          document.getElementById("titleInput").value = "";
          document.getElementById("urlInput").value = "";
          document.getElementById("imageInput").value = "";
          document.getElementById("subjectInput").selectedIndex = 0;
          document.getElementById("teacherInput").innerHTML = '<option value="" disabled selected>Ø§Ø®ØªØ± Ù…Ø¯Ø±Ø³</option>';
          document.getElementById("teacherInput").disabled = true;
          document.getElementById("chapterInput").selectedIndex = 0;
          previewImage();
        }
      });
    }

    // ØªÙˆØ³Øª
    function showToast(message, isError = false) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.className = "toast " + (isError ? "error" : "success");
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 3000);
    }

    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª
    const subjects = ["Ø¹Ø±Ø¨ÙŠ", "Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ", "Ø¬ØºØ±Ø§ÙÙŠØ§", "ØªØ§Ø±ÙŠØ®", "ÙÙŠØ²ÙŠØ§Ø¡", "ÙƒÙŠÙ…ÙŠØ§Ø¡", "Ø£Ø­ÙŠØ§Ø¡", "Ø§Ø¯Ø¨ÙŠ"];
    let counts = {};
    subjects.forEach(sub => counts[sub] = 0);

    db.ref("videos").on("value", (snapshot) => {
      subjects.forEach(sub => counts[sub] = 0);
      snapshot.forEach(child => {
        const data = child.val();
        if (counts[data.subject] !== undefined) {
          counts[data.subject]++;
        }
      });
      updateChart();
    });

    let chart;
    function updateChart() {
      const ctx = document.getElementById("videosChart").getContext("2d");
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: subjects,
          datasets: [{
            label: 'Ø¹Ø¯Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª',
            data: subjects.map(sub => counts[sub]),
            backgroundColor: 'rgba(98, 0, 238, 0.7)',
            borderColor: 'rgba(98, 0, 238, 1)',
            borderWidth: 1,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false }},
          scales: {
            y: { beginAtZero: true, ticks: { color: "white" }},
            x: { ticks: { color: "white" }}
          }
        }
      });
    }
  </script>
</body>
</html>
