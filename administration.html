<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© - Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ | Ø´Ø§ØªÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js';
        import { getDatabase, ref, onValue, update, remove, get } from 'https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js';
        
        // ğŸš¨ Configuration - Ù„Ø§Ø²Ù… ØªØ­Ø· Ø§Ù„Ù€ Configuration Ø¨ØªØ§Ø¹Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù‡Ù†Ø§
        const firebaseConfig = {
          apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
          authDomain: "thanawy-1383.firebaseapp.com",
          databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
          projectId: "thanawy-1383",
          storageBucket: "thanawy-1383.firebasestorage.app",
          messagingSenderId: "1026664406457",
          appId: "1:1026664406457:web:87d71f7e41bef36ba0aa68",
          measurementId: "G-J5R2EFM2D0"
        };
        
        // **********************************************
        // ğŸš€ ØªÙ‡ÙŠØ¦Ø© Firebase (Ø¨Ø¯Ø¡ Ø³Ø±ÙŠØ¹)
        // **********************************************
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠÙ‹Ø§ (Global Functions)
        window.db = db;
        window.get = get;
        window.ref = ref;
        window.update = update;
        window.remove = remove;
        window.getUniqueActivationCode = getUniqueActivationCode;
        window.addNewCode = addNewCode;
        window.blockCode = blockCode;
        window.deleteCode = deleteCode;
        window.renewCode = renewCode;
        window.filterCodes = filterCodes;
        window.loadCodes = loadCodes;
        window.displayAdminStats = displayAdminStats; 
        
        
        const statusEl = document.getElementById('statusEl');
        const activeCodesBody = document.getElementById('activeCodesBody');
        const deactivatedCodesBody = document.getElementById('deactivatedCodesBody');
        const adminStatsEl = document.getElementById('adminStats'); 
        const adminRenewStatsEl = document.getElementById('adminRenewStats'); // ğŸ†• Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯
        const adminTotalStatsEl = document.getElementById('adminTotalStats'); // ğŸ†• Ø¹Ù†ØµØ± Ø¬Ø¯ÙŠØ¯

        // **********************************************
        // ğŸš¨ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙØ±ÙŠØ¯ (6 Ø£Ø±Ù‚Ø§Ù…)
        // **********************************************

        function generateRandom6DigitUID() {
            const min = 100000;
            const max = 999999;
            return Math.floor(Math.random() * (max - min + 1) + min).toString();
        }

        
        async function isUIDUsed(uid) {
            try {
                const approvedSnap = await get(ref(db, 'approvedStudents/' + uid)); 
                const pendingSnap = await get(ref(db, 'pendingStudents/' + uid));
                
                return approvedSnap.exists() || pendingSnap.exists();
            } catch (error) {
                console.error("Firebase Check Error:", error);
                window.showToast("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯.", "error");
                return false; 
            }
        }
        
        async function getUniqueActivationCode() {
            let uid;
            let isUsed = true;
            let attempts = 0;
            const maxAttempts = 50; 
            
            statusEl.textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ ÙØ±ÙŠØ¯...';

            while (isUsed && attempts < maxAttempts) {
                uid = generateRandom6DigitUID();
                isUsed = await isUIDUsed(uid); 
                attempts++;
            }
            
            if(attempts >= maxAttempts && isUsed) {
                throw new Error("âŒ ÙØ´Ù„ ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ ÙØ±ÙŠØ¯ Ø¨Ø¹Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¹Ø¯ÙŠØ¯Ø©.");
            }
            return uid;
        }

        // **********************************************
        // ğŸš¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ÙØ¹Ù„Ø© (Active Codes)
        // **********************************************
        async function addNewCode(isTrial = false) { 
            const name = document.getElementById('newStudentName').value.trim();
            const durationDays = isTrial ? (1 / 24) : parseInt(document.getElementById('newDuration').value);
    
            if (!name) {
                window.showToast("âŒ Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨.", "error");
                return;
            }
            if (!isTrial && (durationDays < 1 || durationDays > 300)) {
                window.showToast("âŒ Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¯Ø© Ø¨ÙŠÙ† 1 Ùˆ 300 ÙŠÙˆÙ… Ù„ÙƒÙˆØ¯ Ø¹Ø§Ø¯ÙŠ.", "error");
                return;
            }

            const adminName = document.getElementById('addingAdminName').value.trim() || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
    
            try {
                const newCode = await getUniqueActivationCode();
        
                const approvedAt = Date.now();
                const expiry = approvedAt + (durationDays * 24 * 60 * 60 * 1000); 

                await update(ref(db, 'approvedStudents/' + newCode), {
                    name: name,
                    admin: adminName, // ğŸ”´ Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø°ÙŠ Ø£Ø¶Ø§Ù Ø§Ù„ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯Ù‹Ø§
                    approvedAt: approvedAt, 
                    expiry: expiry,
                    deviceId: "",
                    isBlocked: false,
                    isExpired: false,
                    deactivatedOn: null,
                    isTrial: isTrial,
                    renewAdmin: null // ğŸ†• ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®Ø§ØµÙŠØ© Ù„Ù„ØªØ¬Ø¯ÙŠØ¯
                });

                const msg = isTrial ? 
                    `âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ ØªØ¬Ø±Ø¨Ø© (Ø³Ø§Ø¹Ø©) Ø¬Ø¯ÙŠØ¯: ${newCode} Ù„Ù„Ø·Ø§Ù„Ø¨: ${name}` :
                    `âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯: ${newCode} Ù„Ù„Ø·Ø§Ù„Ø¨: ${name}`;

                window.showToast(msg, "success");
                document.getElementById('newStudentName').value = '';
                document.getElementById('addingAdminName').value = ''; 
                if(!isTrial) document.getElementById('newDuration').value = 30;
                loadCodes(); 
            } catch (error) {
                window.showToast("âŒ Ø®Ø·Ø£: " + error.message, "error");
                console.error(error);
            }
        }
        
        // **********************************************
        // ğŸš¨ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯
        // **********************************************

        // 1. ØªØ¹Ø·ÙŠÙ„ (Block)
        function blockCode(uid, name) {
            if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ¹Ø·ÙŠÙ„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ${name} (${uid})ØŸ`)){
                update(ref(db, 'approvedStudents/' + uid), {
                    isBlocked: true,
                    deviceId: "",
                    deactivatedOn: Date.now()
                }).then(() => {
                    window.showToast(`ğŸ›‘ ØªÙ… ØªØ¹Ø·ÙŠÙ„ ÙƒÙˆØ¯ ${uid}.`, "warn");
                    loadCodes();
                }).catch(e => window.showToast("âŒ ÙØ´Ù„ Ø§Ù„ØªØ¹Ø·ÙŠÙ„: " + e.message, "error"));
            }
        }

        // 2. Ø­Ø°Ù (Delete)
        function deleteCode(uid, name, listName) {
            if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ${name} (${uid}) Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© ${listName}ØŸ`)){
                remove(ref(db, 'approvedStudents/' + uid)).then(() => {
                    window.showToast(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ ${uid} Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§.`, "error");
                    loadCodes();
                }).catch(e => window.showToast("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + e.message, "error"));
            }
        }

        // 3. ØªØ¬Ø¯ÙŠØ¯/ØªÙØ¹ÙŠÙ„ (Renew/Activate) - ğŸ†• ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…ÙØ¬Ø¯Ø¯
        function renewCode(uid, name, durationInputId) {
            const durationDays = parseInt(document.getElementById(durationInputId).value);

            if (durationDays < 1 || durationDays > 300) {
                window.showToast("âŒ Ø§Ù„Ù…Ø¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 300 ÙŠÙˆÙ….", "error");
                return;
            }
            
            const adminName = prompt(`Ø¨Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø°ÙŠ ÙŠÙ‚ÙˆÙ… Ø¨ØªØ¬Ø¯ÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ${name} (${uid}):`);
            
            if (!adminName || adminName.trim() === "") {
                window.showToast("âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯. ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù.", "error");
                return;
            }
            
            if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªÙØ¹ÙŠÙ„ ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ${name} (${uid}) Ù„Ù…Ø¯Ø© ${durationDays} ÙŠÙˆÙ… Ø¨ÙˆØ§Ø³Ø·Ø© ${adminName}?`)){
                const approvedAt = Date.now();
                const expiry = approvedAt + (durationDays * 24 * 60 * 60 * 1000); 

                update(ref(db, 'approvedStudents/' + uid), {
                    approvedAt: approvedAt,
                    expiry: expiry,
                    isBlocked: false,
                    isExpired: false,
                    deactivatedOn: null,
                    deviceId: "",
                    renewAdmin: adminName.trim() // ğŸ†• Ø­ÙØ¸ Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…ÙØ¬Ø¯Ø¯
                }).then(() => {
                    window.showToast(`âœ… ØªÙ… ØªÙØ¹ÙŠÙ„/ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯ ${uid} Ù„Ù€ ${durationDays} ÙŠÙˆÙ… Ø¨ÙˆØ§Ø³Ø·Ø© ${adminName}.`, "success");
                    loadCodes();
                }).catch(e => window.showToast("âŒ ÙØ´Ù„ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯: " + e.message, "error"));
            }
        }

        // ğŸ†• Ø¯Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù„Ù„Ø¹Ø±Ø¶
        function getDeviceType(deviceId) {
            if (!deviceId || deviceId === "") return 'âš ï¸ ØºÙŠØ± Ù…ÙØ³Ø¬Ù„';
            const idLower = deviceId.toLowerCase();
            if (idLower.includes('android') || idLower.includes('a_') || idLower.includes('mobile')) return 'ğŸ“± Android';
            if (idLower.includes('ios') || idLower.includes('i_') || idLower.includes('iphone')) return 'ğŸ“± iPhone/iPad';
            if (idLower.includes('windows') || idLower.includes('w_') || idLower.includes('desktop')) return 'ğŸ’» Windows';
            return 'âœ… Ø¬Ù‡Ø§Ø² Ù…ÙØ³Ø¬Ù„';
        }


        // **********************************************
        // ğŸš¨ ÙˆØ¸ÙŠÙØ© ÙÙ„ØªØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø«
        // **********************************************
        function filterCodes() {
            const searchActive = document.getElementById('searchActive').value.toLowerCase();
            const searchDeactivated = document.getElementById('searchDeactivated').value.toLowerCase();

            const activeRows = activeCodesBody.getElementsByTagName('tr');
            for (let i = 0; i < activeRows.length; i++) {
                const rowText = activeRows[i].textContent.toLowerCase(); 
                
                if (rowText.includes('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„') || rowText.includes('Ù„Ø§ ÙŠÙˆØ¬Ø¯')) continue; 

                if (rowText.includes(searchActive)) {
                    activeRows[i].style.display = ""; 
                } else {
                    activeRows[i].style.display = "none";
                }
            }

            const deactivatedRows = deactivatedCodesBody.getElementsByTagName('tr');
            for (let i = 0; i < deactivatedRows.length; i++) {
                const rowText = deactivatedRows[i].textContent.toLowerCase();
                
                if (rowText.includes('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„') || rowText.includes('Ù„Ø§ ÙŠÙˆØ¬Ø¯')) continue;
                
                if (rowText.includes(searchDeactivated)) {
                    deactivatedRows[i].style.display = ""; 
                } else {
                    deactivatedRows[i].style.display = "none"; 
                }
            }
        }

        // **********************************************
        // ğŸ†• ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† - ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡Ø§
        // **********************************************
        function displayAdminStats(allCodesData) {
            const newCodeCounts = {};
            const renewCodeCounts = {};
            const totalActivity = {};
            
            allCodesData.forEach(data => {
                const newAdmin = (data.admin && data.admin.trim()) || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                const renewAdmin = (data.renewAdmin && data.renewAdmin.trim()) || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                
                // 1. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (New Codes) - Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ 'admin'
                newCodeCounts[newAdmin] = (newCodeCounts[newAdmin] || 0) + 1;
                
                // 2. Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ (Renewed Codes) - Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ 'renewAdmin'
                // Ù„Ø§ Ù†Ø­Ø³Ø¨ Ø§Ù„ÙƒÙˆØ¯ ÙƒØªØ¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† 'admin' Ùˆ 'renewAdmin' Ù†ÙØ³ Ø§Ù„Ù‚ÙŠÙ…Ø© (Ø¥Ù„Ø§ Ù„Ùˆ ÙƒØ§Ù† ØªØ¬Ø¯ÙŠØ¯Ù‹Ø§ ÙØ¹Ù„ÙŠÙ‹Ø§)
                // Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªÙ… ØªØ¬Ø¯ÙŠØ¯Ù‡Ø§ Ù‡ÙŠ Ø§Ù„ØªÙŠ Ø¨Ù‡Ø§ Ù‚ÙŠÙ…Ø© ÙÙŠ 'renewAdmin'
                if (data.renewAdmin) { 
                    renewCodeCounts[renewAdmin] = (renewCodeCounts[renewAdmin] || 0) + 1;
                }
            });

            // 3. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ© (Ø¥Ø¶Ø§ÙØ© + ØªØ¬Ø¯ÙŠØ¯)
            const allAdmins = new Set([...Object.keys(newCodeCounts), ...Object.keys(renewCodeCounts)]);

            allAdmins.forEach(admin => {
                const newCount = newCodeCounts[admin] || 0;
                const renewCount = renewCodeCounts[admin] || 0;
                totalActivity[admin] = { new: newCount, renew: renewCount, total: newCount + renewCount };
            });

            // --- Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ---
            let newStatsHtml = '<h3>ğŸŒŸ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø¶Ø§ÙØ© **Ø¬Ø¯ÙŠØ¯Ù‹Ø§**:</h3><ul>';
            for (const admin in newCodeCounts) {
                newStatsHtml += `<li><strong>${admin}</strong>: Ø£Ø¶Ø§Ù <strong>${newCodeCounts[admin]}</strong> ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯.</li>`;
            }
            newStatsHtml += '</ul>';
            adminStatsEl.innerHTML = newStatsHtml;

            // --- Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¬Ø¯ÙŠØ¯/Ø§Ù„ØªÙØ¹ÙŠÙ„ ---
            let renewStatsHtml = '<h3>ğŸ”„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙŠ ØªÙ… **ØªØ¬Ø¯ÙŠØ¯Ù‡Ø§/ØªÙØ¹ÙŠÙ„Ù‡Ø§**:</h3><ul>';
            for (const admin in renewCodeCounts) {
                renewStatsHtml += `<li><strong>${admin}</strong>: Ø¬Ø¯Ù‘Ø¯/ÙØ¹Ù‘Ù„ <strong>${renewCodeCounts[admin]}</strong> ÙƒÙˆØ¯.</li>`;
            }
            renewStatsHtml += '</ul>';
            adminRenewStatsEl.innerHTML = renewStatsHtml;

            // --- Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙƒÙ„ÙŠ ---
            let totalStatsHtml = '<h3>ğŸ“ˆ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† (Ø¥Ø¶Ø§ÙØ© + ØªØ¬Ø¯ÙŠØ¯):</h3><ul>';
            const sortedTotal = Object.entries(totalActivity).sort(([,a], [,b]) => b.total - a.total);
            sortedTotal.forEach(([admin, counts]) => {
                totalStatsHtml += `<li><strong>${admin}</strong>: Ø¥Ø¬Ù…Ø§Ù„ÙŠ **${counts.total}** Ø¹Ù…Ù„ÙŠØ© (${counts.new} Ø¬Ø¯ÙŠØ¯ + ${counts.renew} ØªØ¬Ø¯ÙŠØ¯/ØªÙØ¹ÙŠÙ„).</li>`;
            });
            totalStatsHtml += '</ul>';
            adminTotalStatsEl.innerHTML = totalStatsHtml;
        }


        // **********************************************
        // ğŸš¨ ÙˆØ¸ÙŠÙØ© ØªØ­Ù…ÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙÙŠ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ)
        // **********************************************
        function loadCodes() {
            activeCodesBody.innerHTML = `<tr><td colspan='8'>â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ÙØ¹Ù„Ø©...</td></tr>`;
            deactivatedCodesBody.innerHTML = `<tr><td colspan='6'>â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ØºÙŠØ± Ø§Ù„Ù…ÙØ¹Ù„Ø©...</td></tr>`;
            adminStatsEl.innerHTML = '<div>â³ Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†...</div>'; 
            adminRenewStatsEl.innerHTML = ''; // ØªÙØ±ÙŠØº Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            adminTotalStatsEl.innerHTML = '';


            const allCodesData = [];
            const activeRows = [];
            const deactivatedRows = [];
            
            const now = Date.now();

            get(ref(db, "approvedStudents"))
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        activeCodesBody.innerHTML = `<tr><td colspan='8'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ù…ÙØ¹Ù„Ø©.</td></tr>`;
                        deactivatedCodesBody.innerHTML = `<tr><td colspan='6'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ ØºÙŠØ± Ù…ÙØ¹Ù„Ø©.</td></tr>`;
                        statusEl.textContent = `âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­. Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠÙ‹Ø§.`;
                        adminStatsEl.innerHTML = '<h3>ğŸŒŸ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†:</h3><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª.</p>'; 
                        adminRenewStatsEl.innerHTML = '';
                        adminTotalStatsEl.innerHTML = '';
                        return;
                    }

                    // 1. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
                    snapshot.forEach(child => {
                        const uid = child.key;
                        const data = child.val();
                        
                        const isExpired = data.expiry && data.expiry <= now;
                        const isBlocked = data.isBlocked === true;

                        if (isExpired && !isBlocked) {
                            update(ref(db, 'approvedStudents/' + uid), {
                                isExpired: true, 
                                isBlocked: true,
                                deviceId: "",
                                deactivatedOn: now 
                            });
                            data.isExpired = true;
                            data.isBlocked = true;
                            data.deactivatedOn = now;
                        }

                        allCodesData.push({ uid, ...data });
                    });
                    
                    // 2. ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø§Ù„Ø£Ø­Ø¯Ø« (ApprovedAt) Ø£ÙˆÙ„Ø§Ù‹ (ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹)
                    allCodesData.sort((a, b) => (b.approvedAt || 0) - (a.approvedAt || 0));

                    // 3. Ø¨Ù†Ø§Ø¡ ØµÙÙˆÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ±ØªÙŠØ¨
                    allCodesData.forEach(data => {
                        const uid = data.uid;
                        const isExpired = data.isExpired;
                        const isBlocked = data.isBlocked;
                        
                        let expiryDate = data.expiry ? new Date(data.expiry).toLocaleDateString("ar-EG") : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                        
                        if (!isExpired && !isBlocked) { // ÙƒÙˆØ¯ Ù…ÙØ¹Ù„
                            const deviceStatus = getDeviceType(data.deviceId);
                            const approvedDate = data.approvedAt ? new Date(data.approvedAt).toLocaleDateString("ar-EG") : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                            const durationDays = data.expiry ? Math.ceil((data.expiry - data.approvedAt) / (24 * 60 * 60 * 1000)) : '-';

                            const rowContent = `
                                <td>${data.name || "-"}</td>
                                <td style="color:var(--primary); font-weight:700;">${uid}</td>
                                <td>${deviceStatus}</td>
                                <td>${durationDays} ÙŠÙˆÙ…</td> 
                                <td>${approvedDate}</td> 
                                <td>${expiryDate}</td>
                                <td>${data.admin || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"}</td> 
                                <td class="action-cell">
                                    <input type="number" id="renew_active_${uid}" min="1" max="300" value="30" class="duration-input" />
                                    <button class="btn-primary" onclick="renewCode('${uid}','${data.name}','renew_active_${uid}')">ğŸ”„ ØªØ¬Ø¯ÙŠØ¯</button>
                                    <button class="btn-warn" onclick="blockCode('${uid}','${data.name}')">ğŸš« ØªØ¹Ø·ÙŠÙ„</button>
                                    <button class="btn-danger" onclick="deleteCode('${uid}','${data.name}', 'Ø§Ù„Ù…ÙØ¹Ù„Ø©')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </td>
                            `;
                            activeRows.push(`<tr class="code-row">${rowContent}</tr>`);

                        } else {
                            // ğŸ”´ ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙØ¹Ù„ (Deactivated/Expired)
                            let deactivatedDate = data.deactivatedOn ? new Date(data.deactivatedOn).toLocaleDateString("ar-EG") : "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
                            let statusText;

                            if (isBlocked && !isExpired) statusText = 'Ù…ÙØ¹Ø·Ù‘Ù„ ÙŠØ¯ÙˆÙŠÙ‹Ø§';
                            else if (isExpired && data.deactivatedOn) statusText = 'Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§'; 
                            else if (isExpired) statusText = 'Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØªÙ‡';
                            else statusText = 'ØºÙŠØ± Ù†Ø´Ø·';
                            
                            // ğŸ†• Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… Ø¨Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø³Ø§Ø¨Ù‚Ø§Ù‹ (Ø¥Ù† ÙˆØ¬Ø¯)
                            const lastRenewAdmin = data.renewAdmin ? `(${data.renewAdmin})` : ''; 

                            const rowContent = `
                                <td>${data.name || "-"}</td>
                                <td style="color:var(--error); font-weight:700;">${uid}</td>
                                <td><span style="color:${isBlocked ? 'var(--warn)' : 'var(--error)'};">${statusText} ${lastRenewAdmin}</span></td>
                                <td>${deactivatedDate}</td> 
                                <td>
                                    <input type="number" id="renew_deactive_${uid}" min="1" max="300" value="30" class="duration-input" />
                                </td>
                                <td class="action-cell">
                                    <button class="btn-primary" onclick="renewCode('${uid}','${data.name}','renew_deactive_${uid}')">âœ… ØªÙØ¹ÙŠÙ„/ØªØ¬Ø¯ÙŠØ¯</button>
                                    <button class="btn-danger" onclick="deleteCode('${uid}','${data.name}', 'ØºÙŠØ± Ø§Ù„Ù…ÙØ¹Ù„Ø©')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                                </td>
                            `;
                            deactivatedRows.push(`<tr class="code-row">${rowContent}</tr>`);
                        }
                    });

                    activeCodesBody.innerHTML = activeRows.join('') || `<tr><td colspan='8'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ù…ÙØ¹Ù„Ø©.</td></tr>`;
                    deactivatedCodesBody.innerHTML = deactivatedRows.join('') || `<tr><td colspan='6'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ ØºÙŠØ± Ù…ÙØ¹Ù„Ø©.</td></tr>`;
                    statusEl.textContent = `âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${activeRows.length} ÙƒÙˆØ¯ Ù…ÙØ¹Ù„ Ùˆ ${deactivatedRows.length} ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙØ¹Ù„.`;
                    
                    displayAdminStats(allCodesData); // ğŸ†• Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    filterCodes();
                })
                .catch(err => {
                    if (err.code && err.code.includes("permission-denied")) {
                        statusEl.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ù…Ø§Ù† Firebase. ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø°Ù† Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ù…Ø³Ø§Ø± (approvedStudents).";
                    } else {
                        statusEl.textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: " + err.message;
                    }
                    activeCodesBody.innerHTML = `<tr><td colspan='8'>âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</td></tr>`;
                    deactivatedCodesBody.innerHTML = `<tr><td colspan='6'>âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„</td></tr>`;
                    console.error("Firebase Load Error:", err); 
                });
        }
        
        // **********************************************
        // ğŸš¨ Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙˆØ³Øª (Toast Function)
        // **********************************************
        function showToast(message, type = "info") {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement("div");
            toast.className = `toast toast-${type}`;
            toast.textContent = message;

            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                setTimeout(() => toast.remove(), 500); 
            }, 3000);

            toastContainer.appendChild(toast);
        }
        window.showToast = showToast; // Ø¬Ø¹Ù„Ù‡Ø§ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠÙ‹Ø§

        
        // ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„
        loadCodes();
    </script>
</head>
<body>
    <h1>ğŸ”‘ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ§Ù„Ø£Ù…Ø§Ù†</h1>

    <div id="statusEl">âœ… Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    <div id="toast-container"></div>

    <div class="container-grid">
        <div class="admin-section" id="activeCodesSection">
            <h2>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…ÙØ¹Ù„Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§</h2>
            <input type="text" id="searchActive" 
           placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø¨Ø§Ù„ÙƒÙˆØ¯..." 
           onkeyup="filterCodes()" 
           style="margin-bottom:15px; width: 100%;">
            <div class="form-inline">
                <input type="text" id="newStudentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨" required>
                <input type="text" id="addingAdminName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…ÙØ¶ÙŠÙ" required> 
                <input type="number" id="newDuration" placeholder="Ø§Ù„Ù…Ø¯Ø© (ÙŠÙˆÙ…)" min="1" max="300" value="30" required style="max-width: 80px;">
                <button class="btn-primary" onclick="addNewCode()">â• Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø¬Ø¯ÙŠØ¯</button>
                <button class="btn-warn" onclick="addNewCode(true)">â±ï¸ ÙƒÙˆØ¯ ØªØ¬Ø±Ø¨Ø© (Ø³Ø§Ø¹Ø©)</button>
            </div>

            <table>
                <thead>
                    <tr>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</th>
                    <th>Ù†ÙˆØ¹ Ø§Ù„Ø¬Ù‡Ø§Ø²</th> 
                    <th>Ø§Ù„Ù…Ø¯Ø© (ÙŠÙˆÙ…)</th>       
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙØ¹ÙŠÙ„</th>   
                    <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                    <th>Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…ÙØ¶ÙŠÙ</th>   
                    <th class="action-cell">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="activeCodesBody">
                <tr><td colspan='8'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯...</td></tr> 
            </tbody>
        </table>
        </div>

        <div class="admin-section" id="deactivatedCodesSection">
            <h2>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ØºÙŠØ± Ø§Ù„Ù…ÙØ¹Ù„Ø© / Ø§Ù„Ù…Ø¹Ø·Ù„Ø©</h2>
            <input type="text" id="searchDeactivated" 
           placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø¨Ø§Ù„ÙƒÙˆØ¯..." 
           onkeyup="filterCodes()" 
           style="margin-bottom:15px; width: 100%;">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹Ø·ÙŠÙ„/Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>     
                        <th>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯Ø© (ÙŠÙˆÙ…)</th>
                        <th class="action-cell">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="deactivatedCodesBody">
                    <tr><td colspan='6'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯...</td></tr> 
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="container-grid" style="grid-template-columns: 1fr 1fr; margin-top: 20px;">
        <div id="adminStats" class="admin-stats-section admin-section">
            <div>â³ Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...</div>
        </div>
        
        <div id="adminRenewStats" class="admin-stats-section admin-section">
            <div>â³ Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ¬Ø¯ÙŠØ¯/Ø§Ù„ØªÙØ¹ÙŠÙ„...</div>
        </div>
    </div>

    <div id="adminTotalStats" class="admin-stats-section admin-section" style="grid-column: 1 / -1; margin-top: 15px; max-width: 1400px; margin: 15px auto;">
        <div>â³ Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†...</div>
    </div>
    
<style>
/* ğŸ¨ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
:root {
    --primary: #00F57C; /* Ø£Ø®Ø¶Ø± Ø³Ø§Ø·Ø¹ */
    --secondary: #FFD700; /* Ø£ØµÙØ± Ø°Ù‡Ø¨ÙŠ */
    --bg-dark: #121212;
    --card-dark: #1e1e1e;
    --text-light: #f5f5f5;
    --error: #FF4F4F;
    --warn: #ffb347;
    --hover-dark: #2a2a2a; 
}

body { 
    font-family: 'Cairo', sans-serif; 
    background: var(--bg-dark); 
    color: var(--text-light); 
    padding: 10px; 
    text-align: right;
}
h1 { text-align:center; color:var(--primary); margin-bottom: 20px; font-weight: 700; }

.container-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px; 
    max-width: 1400px;
    margin: 0 auto;
}

.admin-section {
    background: var(--card-dark);
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5); 
    overflow-x: auto; 
    animation: fadeIn 0.8s ease-out; 
}
.admin-section h2 { 
    color: var(--secondary); 
    margin-bottom: 15px;
    border-bottom: 2px solid rgba(255, 215, 0, 0.2);
    padding-bottom: 10px;
    text-align: right; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù„Ù„ÙŠÙ…ÙŠÙ† */
}

/* ğŸ·ï¸ Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
button { 
    padding: 7px 10px; 
    margin: 3px;
    cursor: pointer; 
    border: none; 
    border-radius: 8px; 
    font-weight: 700;
    transition: 0.3s;
    font-family: 'Cairo', sans-serif; 
    white-space: nowrap; 
    flex-grow: 1; 
    font-size: 13px; 
}
.btn-primary { background: var(--primary); color: var(--bg-dark); }
.btn-danger { background: var(--error); color: var(--text-light); }
.btn-warn { background: var(--warn); color: var(--bg-dark); }
.btn-primary:hover, .btn-danger:hover, .btn-warn:hover { 
    opacity: 0.9; 
    transform: translateY(-1px) scale(1.01); 
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

/* ğŸ“Š Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
table { 
    width: 100%; 
    min-width: 700px; 
    border-collapse: collapse; 
    margin-top:15px; 
    font-size: 13px; 
    text-align: right; 
}
th, td { 
    padding: 8px 5px; 
    text-align: right; 
    border-bottom: 1px solid #333; 
    vertical-align: middle; 
}
th { background: #333; color: var(--primary); font-weight: 700; }
tr:hover { background: var(--hover-dark); }
.code-row { animation: slideIn 0.5s ease-out; }

/* ğŸ“ Ø³ØªØ§ÙŠÙ„ Ø§Ù„ÙÙˆØ±Ù… ÙˆØ§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
input[type="text"], input[type="number"], select {
    padding: 8px; 
    margin: 5px 0;
    border-radius: 8px;
    border: 1px solid #555;
    background: #333;
    color: var(--text-light);
    width: 100%;
    transition: border-color 0.3s, box-shadow 0.3s;
}

/* ØªØ¹Ø¯ÙŠÙ„ ØªØ±ØªÙŠØ¨ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¶Ø§ÙØ© ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ø¶ØºØ·Ù‡Ø§ */
.form-inline {
    display: flex;
    gap: 5px;
    align-items: center;
    margin-bottom: 15px;
    flex-wrap: wrap;
}
.form-inline > * { 
    flex-grow: 1; 
    min-width: 100px; 
}
.form-inline input[type="number"] {
    max-width: 80px; 
    flex-grow: 0;
}
.form-inline button { 
    flex-grow: 0; 
    padding: 8px 10px;
}


/* ØªØ¹Ø¯ÙŠÙ„ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
.action-cell { 
    width: 170px; 
    min-width: 170px; 
    display: flex; 
    flex-wrap: wrap; 
    gap: 3px; 
    justify-content: flex-end; 
    align-items: center;
}
.action-cell input {
    flex-grow: 1; 
    max-width: 50px; 
    text-align: center;
    padding: 4px;
}
.action-cell button {
    flex-grow: 1; 
    min-width: 50px; 
    margin: 0;
}

.duration-input { 
    max-width: 60px !important; 
    margin: 0 !important; 
    padding: 4px !important;
}

/* ØªØ®ØµÙŠØµ Ø¹Ø±Ø¶ Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ù„Ø¶Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
#activeCodesSection table th:nth-child(1), 
#activeCodesSection table td:nth-child(1) { width: 15%; min-width: 80px; } 
#activeCodesSection table th:nth-child(2), 
#activeCodesSection table td:nth-child(2) { width: 15%; min-width: 90px; } 
#activeCodesSection table th:nth-child(4), 
#activeCodesSection table td:nth-child(4) { width: 7%; min-width: 50px; } 
#activeCodesSection table th:nth-child(8), 
#activeCodesSection table td:nth-child(8) { width: 25%; min-width: 170px; } 


/* Ø³ØªØ§ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ Ù„Ù‚Ø³Ù… Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ† */
.admin-stats-section {
    padding: 20px;
    text-align: right;
}
.admin-stats-section h3 {
    color: var(--primary);
    border-bottom: 1px solid #333;
    padding-bottom: 10px;
    margin-bottom: 15px;
    text-align: right;
}
.admin-stats-section ul {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: flex-start;
}
.admin-stats-section li {
    background: #333;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 14px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    transition: background 0.3s;
}
.admin-stats-section li:hover {
    background: var(--hover-dark);
}
.admin-stats-section li strong:first-child {
    color: var(--secondary);
}
.admin-stats-section li strong:last-child {
    color: var(--primary);
    font-size: 15px;
}


/* Ø³ØªØ§ÙŠÙ„ Ø§Ù„ØªÙˆØ³Øª */
#toast-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 10000;
}
.toast {
    padding: 12px 20px;
    border-radius: 10px;
    margin-top: 10px;
    font-weight: 700;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
    opacity: 0;
    animation: toastIn 0.5s forwards;
    transition: opacity 0.5s, transform 0.5s;
    min-width: 200px;
    text-align: right;
}
.toast-success { background: var(--primary); color: var(--bg-dark); }
.toast-error { background: var(--error); color: var(--text-light); }
.toast-warn { background: var(--warn); color: var(--bg-dark); }


/* Media Query Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 1200px) {
    .container-grid {
        grid-template-columns: 1fr; /* Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ */
    }
}
@media (max-width: 768px) {
    body { padding: 5px; }
    .admin-section { padding: 10px; }
    
    table { min-width: 600px; } /* Ø¶Ù…Ø§Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø¹Ø±Ø¶ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */

    .form-inline { 
        flex-direction: row; 
        flex-wrap: wrap; 
    }
    .form-inline input[type="text"] { min-width: 45%; }
    .form-inline input[type="number"] { max-width: 60px; }
}
    </style>
</body>
</html>
