<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¬ ØªØ¹Ø¯ÙŠÙ„ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª | Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f4f6f9;
      color: #333;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h2 {
      color: #007bff;
      margin-top: 20px;
    }

    .container {
      width: 90%;
      max-width: 700px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    input, select, button {
      padding: 10px;
      margin: 6px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: 90%;
      font-size: 16px;
    }

    button {
      background: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: 0.3s;
    }

    button:hover {
      background: #0056b3;
    }

    .video-card {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 10px;
      background: #fafafa;
      text-align: right;
    }

    .video-card p {
      margin: 4px 0;
    }

    .success {
      color: green;
      font-weight: bold;
    }

    .error {
      color: red;
      font-weight: bold;
    }

    .flex {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }

    select {
      width: 48%;
    }

    .logout-btn {
      background: #dc3545;
      width: auto;
      padding: 8px 16px;
      margin-top: 10px;
    }

    .logout-btn:hover {
      background: #b02a37;
    }
  </style>
</head>

<body>

  <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>

  <!-- ğŸ“¦ ØµÙ†Ø¯ÙˆÙ‚ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div class="container" id="loginBox">
    <input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"><br>
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>
    <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- ğŸ§­ Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† -->
  <div class="container" id="adminPanel" style="display:none;">
    <h2>ğŸ¬ ØªØ¹Ø¯ÙŠÙ„ Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</h2>

    <div class="flex">
      <select id="subjectSelect" onchange="loadVideos()">
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>
      </select>
      <select id="teacherSelect" onchange="loadVideos()">
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³ --</option>
      </select>
    </div>

    <div id="videosList" style="margin-top:20px;text-align:right;max-height:400px;overflow-y:auto;">
      <p>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¯Ø±Ø³ Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª...</p>
    </div>

    <button class="logout-btn" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
  </div>

  <script>
    // âœ… Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBK6FZF3LW83qaUHBKYTfiVd2Ozrd1Rf2g",
    authDomain: "thanawy-1383.firebaseapp.com",
    databaseURL: "https://thanawy-1383-default-rtdb.firebaseio.com",
    projectId: "thanawy-1383",
    storageBucket: "thanawy-1383.firebasestorage.app",
    messagingSenderId: "1026664406457",
    appId: "1:1026664406457:web:87d71f7e41bef36ba0aa68",
    measurementId: "G-J5R2EFM2D0"
  };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    const ADMIN_UID = "jstdqdiNVDb5erNApQuzo6d9RAe2";

    // âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    async function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!email || !password) return alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");

      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;

        if (user.uid === ADMIN_UID) {
          document.getElementById("loginBox").style.display = "none";
          document.getElementById("adminPanel").style.display = "block";
          loadFilters();
        } else {
          alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„ÙŠØ³ Ø£Ø¯Ù…Ù†");
          auth.signOut();
        }
      } catch (err) {
        alert("âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + err.message);
      }
    }

    // âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    function logout() {
      auth.signOut();
      document.getElementById("adminPanel").style.display = "none";
      document.getElementById("loginBox").style.display = "block";
    }

    // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ù…Ø¯Ø±Ø³ÙŠÙ† Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function loadFilters() {
      const snapshot = await db.ref("videos").get();
      if (!snapshot.exists()) return alert("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

      const data = snapshot.val();
      const subjects = new Set();
      const teachers = new Set();

      Object.values(data).forEach(v => {
        if (v.subject) subjects.add(v.subject);
        if (v.teacher) teachers.add(v.teacher);
      });

      const subjectSelect = document.getElementById("subjectSelect");
      const teacherSelect = document.getElementById("teacherSelect");

      subjectSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>';
      teacherSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø³ --</option>';

      subjects.forEach(s => subjectSelect.innerHTML += `<option value="${s}">${s}</option>`);
      teachers.forEach(t => teacherSelect.innerHTML += `<option value="${t}">${t}</option>`);
    }

    // âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ù…Ø¯Ø±Ø³
    async function loadVideos() {
      const subject = document.getElementById("subjectSelect").value;
      const teacher = document.getElementById("teacherSelect").value;
      const container = document.getElementById("videosList");
      container.innerHTML = "<p>â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>";

      const snapshot = await db.ref("videos").get();
      if (!snapshot.exists()) {
        container.innerHTML = "<p class='error'>âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</p>";
        return;
      }

      const data = snapshot.val();
      const filtered = Object.entries(data).filter(([id, v]) =>
        (!subject || v.subject === subject) &&
        (!teacher || v.teacher === teacher)
      );

      if (filtered.length === 0) {
        container.innerHTML = "<p class='success'>ğŸ‰ Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</p>";
        return;
      }

      container.innerHTML = "";
      filtered.forEach(([id, v]) => {
        const div = document.createElement("div");
        div.className = "video-card";
        div.innerHTML = `
          <p><b>${v.title || "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†"}</b></p>
          <p style="color:#555;">${v.subject || ""} - ${v.teacher || ""}</p>
          <input id="link-${id}" type="text" value="${v.url || ""}" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
          <button onclick="updateLink('${id}')">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
        `;
        container.appendChild(div);
      });
    }

    // âœ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    async function updateLink(videoId) {
      const input = document.getElementById(`link-${videoId}`);
      const newLink = input.value.trim();
      if (!newLink) return alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­");

      try {
        await db.ref(`videos/${videoId}/url`).set(newLink);
        input.style.borderColor = "green";
        alert("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­");
      } catch (e) {
        alert("âŒ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + e.message);
      }
    }

    // ğŸª„ ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¯ÙˆØ§Ù„ ÙÙŠ Ø§Ù„Ù€window
    window.login = login;
    window.logout = logout;
    window.loadVideos = loadVideos;
    window.updateLink = updateLink;
  </script>
</body>
</html>
